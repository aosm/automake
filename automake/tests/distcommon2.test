#! /bin/sh

# Test to make sure that depcomp and compile are added to DIST_COMMON
# From Pavel Roskin.

. $srcdir/defs || exit 1

cat > configure.in << 'END'
AM_INIT_AUTOMAKE(nonesuch, nonesuch)
PACKAGE=nonesuch
VERSION=nonesuch
AC_PROG_CC
AC_OUTPUT(Makefile subdir/Makefile)
END

cat > Makefile.am << 'END'
SUBDIRS = subdir
END

mkdir subdir
: > subdir/foo.c

cat > subdir/Makefile.am << 'END'
noinst_PROGRAMS = foo
foo_SOURCES = foo.c
foo_CFLAGS = -DBAR
END

rm -f compile depcomp

$ACLOCAL || exit 1
$AUTOMAKE --add-missing || exit 1

test -f compile || exit 1
test -f depcomp || exit 1

sed -n -e '/^DIST_COMMON =.*\\$/ {
   :loop
   p
   n
   /\\$/ b loop
   p
   n
   }' -e '/^DIST_COMMON =/ p' Makefile.in | grep compile || exit 1

sed -n -e '/^DIST_COMMON =.*\\$/ {
   :loop
   p
   n
   /\\$/ b loop
   p
   n
   }' -e '/^DIST_COMMON =/ p' Makefile.in | grep depcomp || exit 1
