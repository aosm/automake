#! /bin/sh

# Try to build and package a program linked to a Libtool library.

required='libtoolize gcc'
. $srcdir/defs || exit 1

cat >> configure.in << 'END'
AC_PROG_CC
AM_PROG_LIBTOOL
AC_OUTPUT
END

cat > Makefile.am << 'END'
lib_LTLIBRARIES = lib0.la
lib0_la_SOURCES = 0.c

bin_PROGRAMS = 1
1_SOURCES = 1.c
1_LDADD = lib0.la
END

cat > 0.c << 'END'
int
zero (void)
{
   return 0;
}
END

cat > 1.c << 'END'
int zero ();

int
main ()
{
   return zero ();
}
END

set -e

# Use --copy to workaround a bug in Cygwin's `cp -p' during distcheck.
# (This bug is already exhibited by subobj9.test.)  In brief: Cygwin's
# `cp -p' tries to preserve group and owner of the source and fails
# to do so under normal accounts.  With --copy we ensure we own all files.

libtoolize --force --copy
$ACLOCAL
$AUTOCONF
$AUTOMAKE --add-missing --copy

./configure
$MAKE
$MAKE distcheck
