#! /bin/sh

# Test for bug reported by Eric Magnien.

. $srcdir/defs || exit 1

cat > configure.in << 'END'
AC_INIT
AM_INIT_AUTOMAKE(nonesuch, nonesuch)
AC_OUTPUT([subdir/Makefile subdir/foo Makefile foo], [true])
END

mkdir subdir

: > Makefile.am
: > subdir/Makefile.am
: > foo.in
: > subdir/foo.in

$ACLOCAL || exit 1
$AUTOMAKE || exit 1

count=`fgrep foo.in Makefile.in | wc -l`
test $count -eq 2 || exit 1

# This ought to work as well.
$ACLOCAL || exit 1
$AUTOMAKE --add-missing --force-missing
