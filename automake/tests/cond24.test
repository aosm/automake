#!/bin/sh

# Check that conditional redefinitions of AC_SUBST'ed variables are detected.
# Report from Patrik Weiskircher

. $srcdir/defs

set -e

cat >>configure.in <<EOF
AC_SUBST([foo], [bar])
AM_CONDITIONAL([COND], [true])
AC_OUTPUT
EOF

cat >Makefile.am <<EOF
if COND
foo = baz
endif
EOF

$ACLOCAL
$AUTOMAKE 2>stderr && exit 1
grep 'foo was already defined' stderr
