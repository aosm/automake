#! /bin/sh

# Check ansi2knr on a source file in subdirectory.
# From Kevin Ryde.

required=gcc
. $srcdir/defs || exit 1

cat > configure.in << 'END'
AC_INIT(ansi6, 1.0)
AM_INIT_AUTOMAKE
AC_PROG_CC
AM_PROG_CC_C_O
AM_C_PROTOTYPES
AC_EXEEXT
AC_OBJEXT
AC_CONFIG_FILES(Makefile)
AC_OUTPUT
END

cat > Makefile.am << 'END'
AUTOMAKE_OPTIONS = ansi2knr subdir-objects
bin_PROGRAMS = hello
hello_SOURCES = hello.c sub/dir.c
END

cat > hello.c << 'END'
#include <stdio.h>

extern int foo ();

int
main (int argc, char **argv)
{
   printf ("%d\n", foo ());
}
END

mkdir sub

cat > sub/dir.c << 'END'
int
foo ()
{
   return 23;
}
END

set -e

$ACLOCAL
$AUTOCONF
$AUTOMAKE -a

./configure am_cv_prog_cc_stdc=no
$MAKE
